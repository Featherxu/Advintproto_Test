<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Data Expression with P5js</title>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.2.0/p5.js"></script>
    <style>
        html,body{
            height:100%;
        }

        body{
            margin:0px;
            display:flex;
            justify-content:center;
            align-items:center;
        }

    </style>

</head>
<body>
    <script>
        let baseURL = "https://api.particle.io/v1/devices/430029001847393035313137/";
        let token = "?access_token=078a639410f7a8655f30a545d59fdb42676a245b";
    
        let param1 = "pot1";
        let param2 = "pot2";
        let param3 = "motion";
        let param4 = "button";
        let data1URL = baseURL + param1 + token; //for potentiometer 1
        let data2URL = baseURL + param2 + token; //for potentiometer 2
        let data3URL = baseURL + param3 + token; //for motion sensor
        let data4URL = baseURL + param4 + token; //for button sensor

        let Futura;
        let angle = 0;

        //TIMER vars
        let currentFactor, prevFactor;
        let timeInterval = 300;
        let whichParam = 1;
        let numberOfParams = 4; //number of sensors you have

        //COLOR vars:
        let myHue = 0;
        let mySat = 100;

        //function preload() {
            //Futura = loadFont('Khand-Bold.ttf');
        //}

        let buttonPressed = false;

        function setup(){
            createCanvas(800,800,WEBGL);
        
            currentFactor= 0;
            prevFactor = 0;

            colorMode(HSB,360,100,100,1);

            let x1 =0;
            let x2 =160;
            let x3 = 320;
            let x4 = 480;
            let x5 = 640;
            let x6 = 800;



            g = createGraphics(950,500);
            g.fill(230);
            //g.background(5,85,245);
            //g.textAlign(CENTER);
            //g.textFont(Futura);
            g.textSize(50);
            g.text('FOOD',x1,100);
            g.text('FOOD',x2,100);
            g.text('FOOD',x4,100);
            g.text('FOOD',x3,100);
            g.text('FOOD',x5,100);
            g.text('FOOD',x6,100);

            let a = 155;
            g.text('FOOD',x1,a);
            g.text('FOOD',x2,a);
            g.text('FOOD',x3,a);
            g.text('FOOD',x4,a);
            g.text('FOOD',x5,a);
            g.text('FOOD',x6,a);



            let b = 205;
            g.text('FOOD',x1,b);
            g.text('FOOD',x2,b);
            g.text('FOOD',x3,b);
            g.text('FOOD',x4,b);
            g.text('FOOD',x5,b);
            g.text('FOOD',x6,b);



            let c = 255;
            g.text('FOOD',x1,c);
            g.text('FOOD',x2,c);
            g.text('FOOD',x3,c);
            g.text('FOOD',x4,c);
            g.text('FOOD',x5,c);
            g.text('FOOD',x6,c);


            let d = 305;
            g.text('FOOD',x1,d);
            g.text('FOOD',x2,d);
            g.text('FOOD',x3,d);
            g.text('FOOD',x4,d);
            g.text('FOOD',x5,d);
            g.text('FOOD',x6,d);

            let e = 355;
            g.text('FOOD',x1,e);
            g.text('FOOD',x2,e);
            g.text('FOOD',x3,e);
            g.text('FOOD',x4,e);
            g.text('FOOD',x5,e);
            g.text('FOOD',x6,e);

            let f = 405;
            g.text('FOOD',x1,f);
            g.text('FOOD',x2,f);
            g.text('FOOD',x3,f);
            g.text('FOOD',x4,f);
            g.text('FOOD',x5,f);
            g.text('FOOD',x6,f);


            let h = 455;
            g.text('FOOD',x1,h);
            g.text('FOOD',x2,h);
            g.text('FOOD',x3,h);
            g.text('FOOD',x4,h);
            g.text('FOOD',x5,h);
            g.text('FOOD',x6,h);


        }

        function draw(){
            background(myHue, mySat,100);
            

            currentFactor = millis()% timeInterval;
            if(currentFactor<prevFactor){ //passed an interval
                if(whichParam ==1){
                    loadJSON(data1URL,dataHandle,errorHandle);
                }
                else if(whichParam ==2) {
                    loadJSON(data2URL,dataHandle,errorHandle);
                }
                else if(whichParam ==3) {
                    loadJSON(data3URL,dataHandle,errorHandle);
                }
                else {
                    loadJSON(data4URL,dataHandle,errorHandle)
                }
     
                whichParam++;
                if(whichParam == (numberOfParams+1)) whichParam = 1;
            }
            prevFactor = currentFactor; //prep for the next frame
            
            
            rotateY(angle);
              //rotateY(-0.7);
            //  g.position(100,0,0);
            
            //rotateZ(-1.55);
            rotateY(0);
            //  rotateX(angle);

            texture(g);
              //fill(100,20);
            noStroke();
            cylinder(180,400,500,100);
            angle -= 0.02;
            
        }

        function dataHandle(JSONdata){
            console.log(JSONdata);
            if(JSONdata.name ==="pot1"){
                myHue = map(parseInt(JSONdata.result),0,4096,0,360);
            }
            else if(JSONdata.name ==="pot2"){
                mySat = map(parseInt(JSONdata.result),0,4096,0,100);

            }
            
        }
        function errorHandle(Error){
            console.log("Error has occured:"+Error);
        }

    </script>
</body>
</html>